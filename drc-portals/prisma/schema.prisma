// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DCC {
  id            String @id @default(uuid())
  label         String
  description   String?
  homepage      String
  icon          String?
  annotation    Json?
  publications  DCCPublication[]
  assets        DccAsset[]
  @@map("dccs")
}

model Publication {
  id            String @id @default(uuid())
  citation      String
  toolId        String?
  dccs          DCCPublication[]
  tool          Tool? @relation(fields: [toolId], references: [id])
  @@map("publications")
}

model DCCPublication {
  publication   Publication @relation(fields: [publicationId], references: [id])
  publicationId String
  dcc           DCC @relation(fields: [dccId], references: [id])
  dccId         String

  @@id([publicationId, dccId])
  @@map("dcc_publications")
}

model Tool {
  id            String @id @default(uuid())
  label         String
  description   String?
  url           String
  icon          String?
  publications  Publication[]
  @@map("tools")
}

model DccAsset {
  dccId         String
  dcc           DCC? @relation(fields: [dccId], references: [id])
  filetype      String
  filename      String
  link          String
  size          Int?
  lastmodified  DateTime  @default(now())
  current       Boolean   @default(true)
  creator       String
  approved      Boolean   @default(false)
  annotation    Json?     @db.JsonB

  @@unique([dccId, filetype, link, lastmodified])
  @@id([dccId, filetype, link, lastmodified])
  @@map("dcc_assets")
}
